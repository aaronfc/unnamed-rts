## Tasks

## Pipeline
- [X] Main Building / Villagers creation
	- Display actions popup.
	- Add button to create villager.
	- Make villager creation to cost resource and time
	- Avoid villagers stacking / overlapping on creation
	- Show basic info on villagers enqueued for creation
	- extra ball: show villager creation progress info
- [X] When a building is selected, all other entities should be unselected (villagers). Same for when a building is selected and we click on other entities (villagers).
- [X] Increase "drag" for villagers upon receiving a collision - using setFrictionAir
- [X] Slow down the collecting action
- [X] Refactoring villagers code preparing for enemies creation
	- Reduce `.target` and `.destination` entities into a single one.
	- Delegated the margin calculation to the `.target` object.
	- Extracted the if/else construction for movement to a separate method.
	- Extracted all movement related methods to a separated `movement.js`
- [X] GUI revamp
	- Use smaller icons (currently 512x512, which is too big)
	- Get an icon for time
- [X] Review if we can use `setFriction` instead of `setFrictionAir` - we can not
- [X] Basic enemies
	- Create the enemy entity
	- Make enemies logic to attack the villagers
	- Add "health" concept for villagers
	- Make enemies appear randomly (time and space)
- [X] üêõ Support gathering speed for villagers higher than 1u/s
- [X] TownCenter + TownCenterMenu refactoring
- [X] üêõ Villagers creation taking forever (over 100%)
- [X] Add defensive capabilities to Villagers
	- Refactor all fighting related logic from Enemy
	- Add health concept to enemies
	- Defend when attacked
	- Attack when commanded
- [X] üêõ Make entities stop moving sliding when fighting
- [X] üêõ Enemy not looking for closest enemy continuously
- [ ] üêõ When dying (enemy or villager) we should remove all listeners (added when selected for example)
- [ ] Add some health bar or similar.
- [ ] Do more testing about fighting and check the [game document][1]
- [ ] Tune up the "basic game numbers"? Enemy creation random ranges. Health. Resource. Time... Adding more resources around the map...
	- Set waves to happeng every 1 minute increasing in size.
- [ ] Add "You survived for XX time" message with a "restart" button when dead. Store record?
- [ ] Camera.
	- [offline] How the camera should work?
	- [offline] Document that in the [game document][1].
	- Implement camera.
- üéâ Basic game concept done! 0.1 version
- [ ] Villager refactor: Extract status to Tasks
- [ ] üß† Review documentation notes and tasks and plan future versions (0.2)
- [ ] Randomly generate map.
	- Main building position and resources.
	- Document that in the [game document][1].
- [ ] Implement enemy waves
- [ ] Add "you are being attacked" alert.
- [ ] Add "scenes" to the game.
	- Loading screen.
	- Main menu
	- Game (everything done until now)

## Done
- [X] Extract building to a separate class
- [X] Check if `.update()` has to be manually called or it's already called by adding the GameObject to the scene. - We need it!
- [X] Migrate "movement" to a "walking-to-position" status.
- [X] Refactor: Generify the walking to "somewhere" behaviour. - Yes, we did it but only the first phase.
- [X] Resource depletion.
	- Resource representation: for the moment play with opacity.
	- When empty, resource should be destroyed.
	- Implement logic on villagers for when Resource is destroyed.
- [X] Make game bigger for stream
- [X] GUI
	- Create "Game Counters / Score"
	- Number of villagers
	- Game time
	- Amount of resource
- [X] Make GUI more fancy
	- Text is blurry because of the canvas manual resizing done in index.html
	- Time needs to be formatted properly so that we have minutes and hours
	- Increase depth level so that GUI is over the rest of the game
	- Add icons
- [X] Bugfixing / Debugging villagers movement issues
	- [X] #1 üêõ Villagers are overlapping one with eachother when crowded.
		- Maybe we can create some simplified test? To see if it's because of Arcade physics and find possible solutions.
		- More difficult to reproduce probably since we started using `physics.move` method.
		- Still happened, though... And can't find a way to reproduce.
		- After talking on Discord with @samme it seems like my initial guess was right. It seems a limitation on how Arcade Physics resolve collisions. They rely on a "Projection Method" which does not take into account any other collision. The only suggestion is to move to MatterJS physiscs engine.
		- Some MatterJS + Phaser3 tutorial [here][2] 
	- [X] #2 üêõ Villagers moving infinitely upon collision
		- Set villagers as inmovable didn't work. Because when two bodies are immovable they won't collide (which kind-of makes sense).
		- Setting `drag` fixed the issue. But we spent a lot of time trying to set it up because we missunderstood the value passed to the `setDrag` method, it's not a percentage but an amount of pixel.
	- [X] #4 üêõ Villager might get into an unknown status when trying to gather resource and resource is destroyed. It was detected while doing a quick test by generating many villagers and sending them to consume the same resource. All of them behaved correctly (going back to initial position) except from one, which was "stuck" close to the already non-existent resource. ‚ö†Ô∏è This might be related to #3.
	- [X] #3 üêõ Villagers getting "stuck" while consuming resource. Not consuming and not moving. Maybe there is a gap between them and the resource but the movement is not getting them closer?
		- Increased the marging to consider an object as "closer" as possible to another one.
- [X] Moving to MatterJS physics engine
- [X] Add reference to Phaser3 in README.

# References
[1]: https://docs.google.com/document/d/1VEOTnC9N4-9KWOarlTR5_SHRbzlGuOpvtSXMWkIF8vs/edit#
[2]: https://itnext.io/modular-game-worlds-in-phaser-3-tilemaps-4-meet-matter-js-abf4dfa65ca1 
